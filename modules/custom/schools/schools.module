<?php

/**
 * Implements hook_menu().
 */
function schools_menu() {
/**
 * Sample code from the api example.
 *  items['blog'] = array(
 *    'title' => 'blogs',
 *    'page callback' => 'blog_page',
 *    'access arguments' => array('access content'),
 *    'type' => MENU_SUGGESTED_ITEM,
 *);
 *return items;
 */

 /* Your code here */
 $items = array();
 $items['schools'] = array(
   'title' => 'Schools',
   'page callback' => 'schools_overview_page',
   'access callback' => TRUE
 );
 $items['schools/%'] = array(
  'title' => 'Schools Form',
  'page callback' => 'schools_form_page',
  'access callback' => TRUE
);

 return $items;

}

/**

 * Implements hook_init().

 */

function schools_init() {
  // Prevent the page from being cached.
  // drupal_page_is_cacheable(FALSE);
  // drupal_flush_all_caches();
}

function schools_overview_page() {

  $records = db_query('SELECT * FROM {schools}')->fetchAllAssoc('school_id');

  // dpm($records);
  // dpm(gettype($records));
  // return array();
  function getSchoolName($school)
  {
    return($school->name);
  }

  $names = array_map('getSchoolName', $records);
    
  return array(
    '#type' => 'container',
    'schools' => array(
      '#theme' => 'item_list',
      '#items' => $names,
    ),
  );

}


function schools_form_page() {
  $form = drupal_get_form('schools_create_school_form');
  // dpm($form);

  return $form;
}

function schools_create_school_form($form, &$form_state) {
  $form['title'] = array(
    '#markup' => '<h2>Register a school</h2>',
  );
  $form['school_name'] = array(
    '#type' => 'textfield', 
    '#title' => 'School Name',   
    '#maxlength' => 128, 
    '#required' => TRUE,
  );
  $form['school_address'] = array(
    '#type' => 'textfield', 
    '#title' => 'School Address',   
    '#maxlength' => 128, 
    '#required' => TRUE,
  );
  $form['school_zip'] = array(
    '#type' => 'textfield', 
    '#title' => 'Zip Code',   
    '#maxlength' => 128, 
    '#required' => TRUE,
  );
  $form['submit'] = array(
    '#type' => 'submit', 
    '#value' => 'Submit',
  );
  $form['#attached']['css'] = array(
    drupal_get_path('module', 'schools') . '/css/schools_form.css',
  );
  return $form;
}

function schools_create_school_form_validate($form, &$form_state) {
  // dpm($form_state);
}

function schools_create_school_form_submit($form, &$form_state) {
  dpm('submit');
  dpm($form_state);
}